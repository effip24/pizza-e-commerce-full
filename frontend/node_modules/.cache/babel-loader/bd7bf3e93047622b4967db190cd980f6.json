{"ast":null,"code":"var _jsxFileName = \"/Users/effiphil/Desktop/pizza-e-commerce-full/frontend/src/components/App/App.js\",\n    _s = $RefreshSig$();\n\nimport { Switch, Route, useHistory } from \"react-router-dom\";\nimport \"./App.css\";\nimport Header from \"../Header/Header\";\nimport Home from \"../Pages/Home/Home\";\nimport Menu from \"../Pages/Menu/Menu\";\nimport Contact from \"../Pages/Contact/Contact\";\nimport Cart from \"../Pages/Cart/Cart\";\nimport Checkout from \"../Pages/Checkout/Checkout\";\nimport Order from \"../Pages/MyOrder/MyOrder\";\nimport Admin from \"../Pages/Admin/Admin\";\nimport NothingFound from \"../NothingFound/NothingFound\";\nimport ProtectedRoute from \"../ProtectedRoute/ProtectedRoute\";\nimport Login from \"../Login/Login\";\nimport Footer from \"../Footer/Footer\";\nimport mainApi from \"../../utils/MainApi\";\nimport { useEffect, useState } from \"react\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst App = () => {\n  _s();\n\n  const [menu, setMenu] = useState([]);\n  const [discountPizzas, setDiscountPizzas] = useState([]);\n  const [cartList, setCartList] = useState(JSON.parse(localStorage.getItem(\"cart\") || \"[]\"));\n  const [totalPrice, setTotalPrice] = useState(0);\n  const [shipping, setShipping] = useState(10);\n  const [ordersHistory, setOrdersHistory] = useState([]);\n  const [customerOrders, setCustomerOrders] = useState([]);\n  const [orderStatus, setOrderStatus] = useState(0);\n  const [isInfoToolTipOpen, setIsIfoToolTipOpen] = useState(false);\n  const [isSearching, setIsSearching] = useState(true);\n  const [isAdmin, setIsAdmin] = useState(false);\n  const [adminToken, setAdminToken] = useState(localStorage.getItem(\"token\"));\n  const [isSending, setIsSending] = useState(false);\n  const [adminLoginError, setAdminLoginError] = useState(false);\n  const history = useHistory();\n  useEffect(() => {\n    setIsSearching(true);\n    mainApi.getMenu().then(menu => {\n      setMenu(menu);\n      setDiscountPizzas(menu.slice(0, 3));\n    }).catch(err => {\n      console.log(\"there was a problem getting menu from server \", err);\n    }).finally(() => {\n      setIsSearching(false);\n    });\n  }, []);\n  useEffect(() => {\n    if (adminToken) {\n      mainApi.updateToken(adminToken);\n      mainApi.checkToken().then(user => {\n        setIsAdmin(user.admin);\n        console.log(isAdmin);\n      }).catch(err => console.log(\"error please log in again \", err));\n\n      if (isAdmin) {\n        mainApi.getOrders().then(orders => {\n          setOrdersHistory(orders.reverse());\n        }).catch(err => {\n          console.log(\"there was a problem getting orders history \", err);\n        });\n      }\n    }\n  }, [adminToken, isAdmin]);\n  useEffect(() => {\n    const total = cartList.map(pizza => parseInt(pizza.pizza.price) * parseInt(pizza.amount)).reduce((prev, curr) => prev + curr, 0);\n    setTotalPrice(total);\n  }, [cartList]);\n\n  const saveToLocalCart = cart => {\n    localStorage.setItem(\"cart\", JSON.stringify(cart));\n  };\n\n  const handleAddToCart = (pizza, amount) => {\n    const inCart = cartList.some(card => card.pizza._id === pizza._id);\n\n    if (!inCart) {\n      setCartList([...cartList, {\n        pizza: pizza,\n        amount: amount\n      }]);\n      saveToLocalCart([...cartList, {\n        pizza: pizza,\n        amount: amount\n      }]);\n    }\n  };\n\n  const handleCartUpdate = (card, amount) => {\n    const updateCartList = cartList.map(pizza => pizza.pizza._id === card.pizza._id ? {\n      pizza: pizza.pizza,\n      amount: amount\n    } : pizza);\n    setCartList(updateCartList);\n    saveToLocalCart(updateCartList);\n  };\n\n  const handleRemoveFromCart = card => {\n    setCartList(cartList.filter(pizza => pizza.pizza._id !== card.pizza._id));\n    saveToLocalCart(cartList.filter(pizza => pizza.pizza._id !== card.pizza._id));\n  };\n\n  const handlePlaceOrder = order => {\n    setIsSearching(true);\n    mainApi.createOrder(order).then(() => {\n      setIsIfoToolTipOpen(true);\n      setCartList([]);\n      setTotalPrice(0);\n      localStorage.removeItem(\"cart\");\n    }).catch(err => {\n      console.log(\"there was a problem placing order\", err);\n    }).finally(() => {\n      setIsSearching(false);\n    });\n  };\n\n  const handleCustomerOrdersSearch = phone => {\n    setIsSearching(true);\n    mainApi.getOrder(phone).then(orders => {\n      setCustomerOrders(orders.reverse());\n    }).catch(err => {\n      console.log(\"there was a problem getting order\", err);\n    }).finally(() => {\n      setIsSearching(false);\n    });\n  };\n\n  const handleOrderStatusCheck = orderId => {\n    mainApi.getOrderStatus(orderId).then(status => {\n      setOrderStatus(status.status);\n    }).catch(err => console.log(\"there was a problem updating order status\", err));\n  };\n\n  const handleNextStage = (orderId, status) => {\n    mainApi.setOrderStatus(orderId._id, status).then(newOrder => {\n      const newOrderHistory = ordersHistory.map(order => order._id === newOrder._id ? newOrder : order);\n      setOrdersHistory(newOrderHistory);\n    }).catch(err => {\n      console.log(\"there was a problem setting order status\", err);\n    });\n  };\n\n  const handleAddToMenu = pizza => {\n    mainApi.addToMenu(pizza).then(newPizza => {\n      setMenu([newPizza, ...menu]);\n    }).catch(err => {\n      console.log(\"there was a problem adding new item to menu\", err);\n    });\n  };\n\n  const handleMenuCardEdit = (card, cardId) => {\n    mainApi.updateMenu(card, cardId).then(updatedItem => {\n      const newMenu = menu.map(pizza => pizza._id === updatedItem._id ? updatedItem : pizza);\n      setMenu(newMenu);\n    }).catch(err => console.log(\"there was a problem updating the menu\", err));\n  };\n\n  const handleRemoveCardFromMenu = cardId => {\n    mainApi.removeFromMenu(cardId).then(card => {\n      const newMenu = menu.filter(pizza => pizza._id !== cardId);\n      setMenu(newMenu);\n    }).catch(err => {\n      console.log(\"there was a problem removing the item from menu\", err);\n    });\n  };\n\n  const handleAdminLogin = (email, password) => {\n    setIsSending(true);\n    setAdminLoginError(false);\n    mainApi.login(email, password).then(token => {\n      setAdminToken(token.token);\n      mainApi.updateToken(token.token);\n      setIsAdmin(true);\n      localStorage.setItem(\"token\", token.token);\n      history.push(\"/admin\");\n    }).catch(err => {\n      setAdminLoginError(true);\n      console.log(\"there was a problem login into admin section\", err);\n    }).finally(() => {\n      setIsSending(false);\n    });\n  };\n\n  const closeAllPopups = () => {\n    setIsIfoToolTipOpen(false);\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"page\",\n    children: [/*#__PURE__*/_jsxDEV(Header, {\n      cartItems: cartList.length,\n      isAdmin: isAdmin\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 230,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Switch, {\n      children: [/*#__PURE__*/_jsxDEV(ProtectedRoute, {\n        path: \"/admin\",\n        isAdmin: isAdmin,\n        children: /*#__PURE__*/_jsxDEV(Admin, {\n          menu: menu,\n          ordersHistory: ordersHistory,\n          onNextStage: handleNextStage,\n          onAddToMenu: handleAddToMenu,\n          onMenuEdit: handleMenuCardEdit,\n          onRemove: handleRemoveCardFromMenu\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 233,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 232,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Route, {\n        exact: true,\n        path: \"/\",\n        children: /*#__PURE__*/_jsxDEV(Home, {\n          discountPizzas: discountPizzas,\n          onAddToCart: handleAddToCart,\n          isSearching: isSearching\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 244,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 243,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Route, {\n        path: \"/menu\",\n        children: /*#__PURE__*/_jsxDEV(Menu, {\n          menu: menu,\n          onAddToCart: handleAddToCart,\n          isSearching: isSearching\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 248,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 247,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Route, {\n        path: \"/contact\",\n        children: /*#__PURE__*/_jsxDEV(Contact, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 252,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 251,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Route, {\n        path: \"/cart\",\n        children: /*#__PURE__*/_jsxDEV(Cart, {\n          cartList: cartList,\n          onUpdateCart: handleCartUpdate,\n          onRemoveFromCart: handleRemoveFromCart,\n          totalPrice: totalPrice,\n          shipping: shipping\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 256,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 255,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Route, {\n        path: \"/checkout\",\n        children: /*#__PURE__*/_jsxDEV(Checkout, {\n          totalPrice: totalPrice,\n          onPlaceOrder: handlePlaceOrder,\n          shipping: shipping,\n          isInfoToolTipOpen: isInfoToolTipOpen,\n          closeAllPopups: closeAllPopups,\n          isSearching: isSearching\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 266,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 265,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Route, {\n        path: \"/order\",\n        children: /*#__PURE__*/_jsxDEV(Order, {\n          customerOrders: customerOrders,\n          onOrderSearch: handleCustomerOrdersSearch,\n          orderStatus: orderStatus,\n          onStatusCheck: handleOrderStatusCheck\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 277,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 276,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Route, {\n        path: \"/login\",\n        children: /*#__PURE__*/_jsxDEV(Login, {\n          onLogin: handleAdminLogin,\n          isSending: isSending,\n          adminLoginError: adminLoginError\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 286,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 285,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Route, {\n        path: \"/*\",\n        children: /*#__PURE__*/_jsxDEV(NothingFound, {\n          showNothingFound: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 290,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 289,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 231,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Footer, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 293,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 229,\n    columnNumber: 5\n  }, this);\n};\n\n_s(App, \"bW8V0FLnuRRkGPHho9Zeb9BPfTY=\", false, function () {\n  return [useHistory];\n});\n\n_c = App;\nexport default App;\n\nvar _c;\n\n$RefreshReg$(_c, \"App\");","map":{"version":3,"sources":["/Users/effiphil/Desktop/pizza-e-commerce-full/frontend/src/components/App/App.js"],"names":["Switch","Route","useHistory","Header","Home","Menu","Contact","Cart","Checkout","Order","Admin","NothingFound","ProtectedRoute","Login","Footer","mainApi","useEffect","useState","App","menu","setMenu","discountPizzas","setDiscountPizzas","cartList","setCartList","JSON","parse","localStorage","getItem","totalPrice","setTotalPrice","shipping","setShipping","ordersHistory","setOrdersHistory","customerOrders","setCustomerOrders","orderStatus","setOrderStatus","isInfoToolTipOpen","setIsIfoToolTipOpen","isSearching","setIsSearching","isAdmin","setIsAdmin","adminToken","setAdminToken","isSending","setIsSending","adminLoginError","setAdminLoginError","history","getMenu","then","slice","catch","err","console","log","finally","updateToken","checkToken","user","admin","getOrders","orders","reverse","total","map","pizza","parseInt","price","amount","reduce","prev","curr","saveToLocalCart","cart","setItem","stringify","handleAddToCart","inCart","some","card","_id","handleCartUpdate","updateCartList","handleRemoveFromCart","filter","handlePlaceOrder","order","createOrder","removeItem","handleCustomerOrdersSearch","phone","getOrder","handleOrderStatusCheck","orderId","getOrderStatus","status","handleNextStage","newOrder","newOrderHistory","handleAddToMenu","addToMenu","newPizza","handleMenuCardEdit","cardId","updateMenu","updatedItem","newMenu","handleRemoveCardFromMenu","removeFromMenu","handleAdminLogin","email","password","login","token","push","closeAllPopups","length"],"mappings":"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","sourcesContent":["import { Switch, Route, useHistory } from \"react-router-dom\";\nimport \"./App.css\";\n\nimport Header from \"../Header/Header\";\nimport Home from \"../Pages/Home/Home\";\nimport Menu from \"../Pages/Menu/Menu\";\nimport Contact from \"../Pages/Contact/Contact\";\nimport Cart from \"../Pages/Cart/Cart\";\nimport Checkout from \"../Pages/Checkout/Checkout\";\nimport Order from \"../Pages/MyOrder/MyOrder\";\nimport Admin from \"../Pages/Admin/Admin\";\nimport NothingFound from \"../NothingFound/NothingFound\";\nimport ProtectedRoute from \"../ProtectedRoute/ProtectedRoute\";\nimport Login from \"../Login/Login\";\nimport Footer from \"../Footer/Footer\";\nimport mainApi from \"../../utils/MainApi\";\nimport { useEffect, useState } from \"react\";\n\nconst App = () => {\n  const [menu, setMenu] = useState([]);\n  const [discountPizzas, setDiscountPizzas] = useState([]);\n\n  const [cartList, setCartList] = useState(JSON.parse(localStorage.getItem(\"cart\") || \"[]\"));\n  const [totalPrice, setTotalPrice] = useState(0);\n  const [shipping, setShipping] = useState(10);\n\n  const [ordersHistory, setOrdersHistory] = useState([]);\n  const [customerOrders, setCustomerOrders] = useState([]);\n  const [orderStatus, setOrderStatus] = useState(0);\n\n  const [isInfoToolTipOpen, setIsIfoToolTipOpen] = useState(false);\n  const [isSearching, setIsSearching] = useState(true);\n\n  const [isAdmin, setIsAdmin] = useState(false);\n  const [adminToken, setAdminToken] = useState(localStorage.getItem(\"token\"));\n  const [isSending, setIsSending] = useState(false);\n  const [adminLoginError, setAdminLoginError] = useState(false);\n\n  const history = useHistory();\n\n  useEffect(() => {\n    setIsSearching(true);\n    mainApi\n      .getMenu()\n      .then((menu) => {\n        setMenu(menu);\n        setDiscountPizzas(menu.slice(0, 3));\n      })\n      .catch((err) => {\n        console.log(\"there was a problem getting menu from server \", err);\n      })\n      .finally(() => {\n        setIsSearching(false);\n      });\n  }, []);\n\n  useEffect(() => {\n    if (adminToken) {\n      mainApi.updateToken(adminToken);\n\n      mainApi\n        .checkToken()\n        .then((user) => {\n          setIsAdmin(user.admin);\n          console.log(isAdmin);\n        })\n        .catch((err) => console.log(\"error please log in again \", err));\n\n      if (isAdmin) {\n        mainApi\n          .getOrders()\n          .then((orders) => {\n            setOrdersHistory(orders.reverse());\n          })\n          .catch((err) => {\n            console.log(\"there was a problem getting orders history \", err);\n          });\n      }\n    }\n  }, [adminToken, isAdmin]);\n\n  useEffect(() => {\n    const total = cartList\n      .map((pizza) => parseInt(pizza.pizza.price) * parseInt(pizza.amount))\n      .reduce((prev, curr) => prev + curr, 0);\n    setTotalPrice(total);\n  }, [cartList]);\n\n  const saveToLocalCart = (cart) => {\n    localStorage.setItem(\"cart\", JSON.stringify(cart));\n  };\n\n  const handleAddToCart = (pizza, amount) => {\n    const inCart = cartList.some((card) => card.pizza._id === pizza._id);\n\n    if (!inCart) {\n      setCartList([...cartList, { pizza: pizza, amount: amount }]);\n      saveToLocalCart([...cartList, { pizza: pizza, amount: amount }]);\n    }\n  };\n\n  const handleCartUpdate = (card, amount) => {\n    const updateCartList = cartList.map((pizza) =>\n      pizza.pizza._id === card.pizza._id ? { pizza: pizza.pizza, amount: amount } : pizza\n    );\n    setCartList(updateCartList);\n    saveToLocalCart(updateCartList);\n  };\n\n  const handleRemoveFromCart = (card) => {\n    setCartList(cartList.filter((pizza) => pizza.pizza._id !== card.pizza._id));\n    saveToLocalCart(cartList.filter((pizza) => pizza.pizza._id !== card.pizza._id));\n  };\n\n  const handlePlaceOrder = (order) => {\n    setIsSearching(true);\n    mainApi\n      .createOrder(order)\n      .then(() => {\n        setIsIfoToolTipOpen(true);\n        setCartList([]);\n        setTotalPrice(0);\n        localStorage.removeItem(\"cart\");\n      })\n      .catch((err) => {\n        console.log(\"there was a problem placing order\", err);\n      })\n      .finally(() => {\n        setIsSearching(false);\n      });\n  };\n\n  const handleCustomerOrdersSearch = (phone) => {\n    setIsSearching(true);\n    mainApi\n      .getOrder(phone)\n      .then((orders) => {\n        setCustomerOrders(orders.reverse());\n      })\n      .catch((err) => {\n        console.log(\"there was a problem getting order\", err);\n      })\n      .finally(() => {\n        setIsSearching(false);\n      });\n  };\n\n  const handleOrderStatusCheck = (orderId) => {\n    mainApi\n      .getOrderStatus(orderId)\n      .then((status) => {\n        setOrderStatus(status.status);\n      })\n      .catch((err) => console.log(\"there was a problem updating order status\", err));\n  };\n\n  const handleNextStage = (orderId, status) => {\n    mainApi\n      .setOrderStatus(orderId._id, status)\n      .then((newOrder) => {\n        const newOrderHistory = ordersHistory.map((order) => (order._id === newOrder._id ? newOrder : order));\n\n        setOrdersHistory(newOrderHistory);\n      })\n      .catch((err) => {\n        console.log(\"there was a problem setting order status\", err);\n      });\n  };\n\n  const handleAddToMenu = (pizza) => {\n    mainApi\n      .addToMenu(pizza)\n      .then((newPizza) => {\n        setMenu([newPizza, ...menu]);\n      })\n      .catch((err) => {\n        console.log(\"there was a problem adding new item to menu\", err);\n      });\n  };\n\n  const handleMenuCardEdit = (card, cardId) => {\n    mainApi\n      .updateMenu(card, cardId)\n      .then((updatedItem) => {\n        const newMenu = menu.map((pizza) => (pizza._id === updatedItem._id ? updatedItem : pizza));\n        setMenu(newMenu);\n      })\n      .catch((err) => console.log(\"there was a problem updating the menu\", err));\n  };\n\n  const handleRemoveCardFromMenu = (cardId) => {\n    mainApi\n      .removeFromMenu(cardId)\n      .then((card) => {\n        const newMenu = menu.filter((pizza) => pizza._id !== cardId);\n        setMenu(newMenu);\n      })\n      .catch((err) => {\n        console.log(\"there was a problem removing the item from menu\", err);\n      });\n  };\n\n  const handleAdminLogin = (email, password) => {\n    setIsSending(true);\n    setAdminLoginError(false);\n    mainApi\n      .login(email, password)\n      .then((token) => {\n        setAdminToken(token.token);\n        mainApi.updateToken(token.token);\n        setIsAdmin(true);\n        localStorage.setItem(\"token\", token.token);\n        history.push(\"/admin\");\n      })\n      .catch((err) => {\n        setAdminLoginError(true);\n        console.log(\"there was a problem login into admin section\", err);\n      })\n      .finally(() => {\n        setIsSending(false);\n      });\n  };\n\n  const closeAllPopups = () => {\n    setIsIfoToolTipOpen(false);\n  };\n\n  return (\n    <div className=\"page\">\n      <Header cartItems={cartList.length} isAdmin={isAdmin} />\n      <Switch>\n        <ProtectedRoute path=\"/admin\" isAdmin={isAdmin}>\n          <Admin\n            menu={menu}\n            ordersHistory={ordersHistory}\n            onNextStage={handleNextStage}\n            onAddToMenu={handleAddToMenu}\n            onMenuEdit={handleMenuCardEdit}\n            onRemove={handleRemoveCardFromMenu}\n          />\n        </ProtectedRoute>\n\n        <Route exact path=\"/\">\n          <Home discountPizzas={discountPizzas} onAddToCart={handleAddToCart} isSearching={isSearching} />\n        </Route>\n\n        <Route path=\"/menu\">\n          <Menu menu={menu} onAddToCart={handleAddToCart} isSearching={isSearching} />\n        </Route>\n\n        <Route path=\"/contact\">\n          <Contact />\n        </Route>\n\n        <Route path=\"/cart\">\n          <Cart\n            cartList={cartList}\n            onUpdateCart={handleCartUpdate}\n            onRemoveFromCart={handleRemoveFromCart}\n            totalPrice={totalPrice}\n            shipping={shipping}\n          />\n        </Route>\n\n        <Route path=\"/checkout\">\n          <Checkout\n            totalPrice={totalPrice}\n            onPlaceOrder={handlePlaceOrder}\n            shipping={shipping}\n            isInfoToolTipOpen={isInfoToolTipOpen}\n            closeAllPopups={closeAllPopups}\n            isSearching={isSearching}\n          />\n        </Route>\n\n        <Route path=\"/order\">\n          <Order\n            customerOrders={customerOrders}\n            onOrderSearch={handleCustomerOrdersSearch}\n            orderStatus={orderStatus}\n            onStatusCheck={handleOrderStatusCheck}\n          />\n        </Route>\n\n        <Route path=\"/login\">\n          <Login onLogin={handleAdminLogin} isSending={isSending} adminLoginError={adminLoginError} />\n        </Route>\n\n        <Route path=\"/*\">\n          <NothingFound showNothingFound={true} />\n        </Route>\n      </Switch>\n      <Footer />\n    </div>\n  );\n};\nexport default App;\n"]},"metadata":{},"sourceType":"module"}